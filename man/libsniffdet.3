.\" SPDX-License-Identifier: GPL-2.0-or-later
.TH LIBSNIFFDET 3 2025-12-21 "libsniffdet 0.10" "Library Functions"
.SH NAME
libsniffdet \- sniffer detection library
.SH SYNOPSIS
.nf
.B #include <libsniffdet.h>
.fi
.PP
.BI "struct sndet_device *sndet_init_device(char *" device ", int " promisc ", char *" errbuf );
.br
.BI "int sndet_finish_device(struct sndet_device *" device ", char *" errbuf );
.PP
.BI "int sndet_icmptest(char *" host ", struct sndet_device *" device ", ...);"
.br
.BI "int sndet_arptest(char *" host ", struct sndet_device *" device ", ...);"
.br
.BI "int sndet_dnstest(char *" host ", struct sndet_device *" device ", ...);"
.br
.BI "int sndet_latencytest_pktflood(char *" host ", struct sndet_device *" device ", ...);"
.SH DESCRIPTION
.B libsniffdet
is a library for detecting machines running in promiscuous mode
on a network.
It provides several detection tests based on academic research
into remote sniffer detection techniques.
.SH DEVICE INITIALIZATION
Before running any tests, initialize the network device:
.PP
.BI "struct sndet_device *sndet_init_device(char *" device ", int " promisc ", char *" errbuf );
.PP
.RS
.TP
.I device
Network interface name (e.g., "eth0", "enp0s3").
.TP
.I promisc
Set to 1 to enable promiscuous mode on the interface.
.TP
.I errbuf
Buffer for error messages (should be at least 256 bytes).
.RE
.PP
Returns a pointer to an
.B sndet_device
structure on success, or NULL on error.
.PP
When finished, release resources with:
.PP
.BI "int sndet_finish_device(struct sndet_device *" device ", char *" errbuf );
.SH CALLBACK FUNCTIONS
All detection tests accept a callback function for progress reporting:
.PP
.BI "int (*user_callback)(struct test_status *" status ", int " msg_type ", char *" msg );
.PP
The callback receives:
.TP
.I status
Current test progress (percent complete, bytes sent/received).
.TP
.I msg_type
One of: RUNNING, NOTIFICATION, ERROR, WARNING, DETECTION, ENDING.
.TP
.I msg
Human-readable message.
.PP
Return non-zero from the callback to cancel the test.
.SH DETECTION TESTS
All tests return 0 on success or non-zero on error.
Results are stored in a
.B struct test_info
passed to each function.
.SS ICMP Test
.BI "int sndet_icmptest(char *" host ", struct sndet_device *" device ","
.BI "unsigned int " tmout ", unsigned int " tries ", unsigned int " send_interval ","
.BI "user_callback " callback ", struct test_info *" result ", char *" fakehwaddr );
.PP
Sends ICMP echo requests with a fake hardware address.
Hosts in promiscuous mode may respond even though the MAC doesn't match.
.SS ARP Test
.BI "int sndet_arptest(char *" host ", struct sndet_device *" device ","
.BI "unsigned int " tmout ", unsigned int " tries ", unsigned int " send_interval ","
.BI "user_callback " callback ", struct test_info *" result ", char *" fakehwaddr );
.PP
Sends ARP requests with a fake hardware address.
Promiscuous hosts may process and respond to these requests.
.SS DNS Test
.BI "int sndet_dnstest(char *" host ", struct sndet_device *" device ","
.BI "unsigned int " tmout ", unsigned int " tries ", unsigned int " send_interval ","
.BI "user_callback " callback ", struct test_info *" info ","
.BI "char *" fake_ipaddr ", char *" fake_hwaddr ","
.BI "ushort " dport ", ushort " sport ", char *" payload ", short int " payload_len );
.PP
Generates bogus TCP traffic to trigger reverse DNS lookups
from sniffing hosts attempting to resolve source addresses.
.SS Latency Test
.BI "int sndet_latencytest_pktflood(char *" host ", struct sndet_device *" device ","
.BI "unsigned int " tmout ", unsigned int " probe_interval ","
.BI "user_callback " callback ", struct test_info *" info ","
.BI "struct custom_info *" bogus_pkt );
.PP
Measures response time changes when flooding the network.
Hosts processing all packets (promiscuous mode) show increased latency.
.SH UTILITY FUNCTIONS
.TP
.BI "u_long sndet_resolve(char *" hostname );
Resolve hostname to network-order IP address.
.TP
.BI "int sndet_random(void);"
Return a cryptographically random integer.
.TP
.BI "u_long sndet_get_iface_ip_addr(struct sndet_device *" dev ", char *" errbuf );
Return interface IP address in host byte order.
.TP
.BI "struct ether_addr *sndet_get_iface_mac_addr(struct sndet_device *" dev ", char *" errbuf );
Return interface MAC address.
.TP
.BI "void sndet_sleep(long " sec ", long " usec );
Portable sleep function.
.SH DATA STRUCTURES
.SS sndet_device
.nf
struct sndet_device {
    char *device;           /* interface name */
    int datalink;           /* datalink type */
    int pkt_offset;         /* sync bytes */
    struct libnet_link_int *ln_int;
    pcap_t *pktdesc;
    bpf_u_int32 network;
    bpf_u_int32 netmask;
    int rawsock;            /* raw socket id */
};
.fi
.SS test_status
.nf
struct test_status {
    unsigned short int percent;  /* 0% to 100% */
    unsigned int bytes_sent;
    unsigned int bytes_recvd;
};
.fi
.SS test_info
.nf
struct test_info {
    enum test_code code;         /* test type */
    int valid;                   /* whether result is valid */
    char *test_name;
    char *test_short_desc;
    time_t time_start;
    time_t time_fini;
    unsigned int b_sent;
    unsigned int b_recvd;
    unsigned int pkts_sent;
    unsigned int pkts_recvd;
    union {
        struct icmptest_result icmp;
        struct arptest_result arp;
        struct dnstest_result dns;
        struct latencytest_result latency;
    } test;
};
.fi
.SH EXAMPLE
See the
.I src/examples/libsniffdet-usage.c
file included in the source distribution.
.SH BUGS
Report bugs at https://github.com/adereis/sniffdet/issues
.SH AUTHORS
Ademar de Souza Reis Jr.
.RI < ademar@ademar.org >
.br
Milton Soares Filho
.RI < eu_mil@yahoo.com >
.SH SEE ALSO
.BR sniffdet (1),
.BR sniffdet.conf (5),
.BR pcap (3),
.BR libnet (3)
